(()=>{"use strict";var e,t,i,a;(a=e||(e={})).White="WHITE",a.Black="BLACK",(i=t||(t={})).Bishop="BISHOP",i.King="KING",i.Knight="KNIGHT",i.Pawn="PAWN",i.Queen="QUEEN",i.Rook="ROOK";const n=Object.freeze({[e.White]:{queenside:0,kingside:7},[e.Black]:{queenside:56,kingside:63}}),o=Object.freeze({[e.White]:{kingside:!1,queenside:!1},[e.Black]:{kingside:!1,queenside:!1}}),s=Object.freeze({b:t.Bishop,B:t.Bishop,k:t.King,K:t.King,n:t.Knight,N:t.Knight,p:t.Pawn,P:t.Pawn,q:t.Queen,Q:t.Queen,r:t.Rook,R:t.Rook}),r=Object.freeze({[t.Bishop]:"b",[t.King]:"k",[t.Knight]:"n",[t.Pawn]:"p",[t.Queen]:"q",[t.Rook]:"r"}),c=[["a8","b8","c8","d8","e8","f8","g8","h8"],["a7","b7","c7","d7","e7","f7","g7","h7"],["a6","b6","c6","d6","e6","f6","g6","h6"],["a5","b5","c5","d5","e5","f5","g5","h5"],["a4","b4","c4","d4","e4","f4","g4","h4"],["a3","b3","c3","d3","e3","f3","g3","h3"],["a2","b2","c2","d2","e2","f2","g2","h2"],["a1","b1","c1","d1","e1","f1","g1","h1"]].reverse().flat(),l=({rank:e,file:t})=>8*e+t,p=e=>c[e],u=e=>c.indexOf(e),g=t=>t===e.White?e.Black:e.White,k=(e,t="")=>{return e.promotion?`${p(e.from)}${t}${p(e.to)}${i=e.promotion,r[i]}`:`${p(e.from)}${t}${p(e.to)}`;var i},f=(t,i)=>t===e.White?i>=8&&i<16:i>=48&&i<56,h=(e,i)=>{for(const[a,n]of e.pieces)if(n.type===t.King&&n.color===i)return a},d=t=>{const i=new Map;for(const[e,a]of t.pieces)i.set(e,a);const a={[e.White]:{kingside:t.castlingAvailability[e.White].kingside,queenside:t.castlingAvailability[e.White].queenside},[e.Black]:{kingside:t.castlingAvailability[e.Black].kingside,queenside:t.castlingAvailability[e.Black].queenside}};return{pieces:i,turn:t.turn,castlingAvailability:a,enPassantSquare:t.enPassantSquare,halfMoveCount:t.halfMoveCount,fullMoveCount:t.fullMoveCount}},y=t=>{const i=new Map;let a=7,n=0;for(const r of t)switch(r){case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":n+=Number(r);break;case"/":a-=1,n=0;break;case"b":case"B":case"k":case"K":case"n":case"N":case"p":case"P":case"q":case"Q":case"r":case"R":i.set(l({rank:a,file:n}),{color:(o=r,"PNBRQK".includes(o)?e.White:e.Black),type:s[r]}),n+=1}var o;return i},B=t=>{const[i,a,n,o,s,r]=t.split(" ");return Object.freeze({pieces:y(i),turn:"w"===a?e.White:e.Black,castlingAvailability:Object.freeze({[e.White]:{kingside:n.includes("K"),queenside:n.includes("Q")},[e.Black]:{kingside:n.includes("k"),queenside:n.includes("q")}}),enPassantSquare:"-"!==o?u(o):null,halfMoveCount:Number(s),fullMoveCount:Number(r)})},v=(BigInt(0),BigInt(1)),q=BigInt(2),b=BigInt(4),m=BigInt(8),I=BigInt(16),S=BigInt(32),P=BigInt(64),A=BigInt(128),W=BigInt(256),K=BigInt(512),M=BigInt(1024),w=BigInt(2048),_=BigInt(4096),O=BigInt(8192),R=BigInt(16384),C=BigInt(32768),Q=BigInt(65536),x=BigInt(131072),E=BigInt(262144),N=BigInt(524288),T=BigInt(1048576),$=BigInt(2097152),j=BigInt(4194304),z=BigInt(8388608),L=BigInt(16777216),H=BigInt(33554432),G=BigInt(67108864),F=BigInt(134217728),U=BigInt(268435456),D=BigInt(536870912),J=BigInt(1073741824),V=BigInt(2147483648),X=BigInt(4294967296),Y=BigInt(8589934592),Z=BigInt(17179869184),ee=BigInt(34359738368),te=BigInt(68719476736),ie=BigInt(137438953472),ae=BigInt(274877906944),ne=BigInt(549755813888),oe=BigInt(1099511627776),se=BigInt(2199023255552),re=BigInt(4398046511104),ce=BigInt(8796093022208),le=BigInt(17592186044416),pe=BigInt(35184372088832),ue=BigInt(70368744177664),ge=BigInt(0x800000000000),ke=BigInt(281474976710656),fe=BigInt(562949953421312),he=BigInt(0x4000000000000),de=BigInt(0x8000000000000),ye=BigInt(4503599627370496),Be=BigInt(9007199254740992),ve=BigInt(0x40000000000000),qe=BigInt(0x80000000000000),be=BigInt(72057594037927940),me=BigInt(0x200000000000000),Ie=BigInt(0x400000000000000),Se=BigInt(0x800000000000000),Pe=BigInt(0x1000000000000000),Ae=BigInt(0x2000000000000000),We=BigInt(0x4000000000000000),Ke=BigInt(0x8000000000000000),Me=[v,W,Q,L,X,oe,ke,be,q,K,x,H,Y,se,fe,me,b,M,E,G,Z,re,he,Ie,m,w,N,F,ee,ce,de,Se,I,_,T,U,te,le,ye,Pe,S,O,$,D,ie,pe,Be,Ae,P,R,j,J,ae,ue,ve,We,A,C,z,V,ne,ge,qe,Ke],we=(Object.freeze({a1:v,a2:W,a3:Q,a4:L,a5:X,a6:oe,a7:ke,a8:be,b1:q,b2:K,b3:x,b4:H,b5:Y,b6:se,b7:fe,b8:me,c1:b,c2:M,c3:E,c4:G,c5:Z,c6:re,c7:he,c8:Ie,d1:m,d2:w,d3:N,d4:F,d5:ee,d6:ce,d7:de,d8:Se,e1:I,e2:_,e3:T,e4:U,e5:te,e6:le,e7:ye,e8:Pe,f1:S,f2:O,f3:$,f4:D,f5:ie,f6:pe,f7:Be,f8:Ae,g1:P,g2:R,g3:j,g4:J,g5:ae,g6:ue,g7:ve,g8:We,h1:A,h2:C,h3:z,h4:V,h5:ne,h6:ge,h7:qe,h8:Ke}),({rank:e,file:t})=>e>=0&&e<8&&t>=0&&t<8),_e=(e,t=1)=>({rank:e.rank+t,file:e.file}),Oe=(e,t=1)=>({rank:e.rank-t,file:e.file}),Re=(e,t=1)=>({rank:e.rank,file:e.file-t}),Ce=(e,t=1)=>({rank:e.rank,file:e.file+t}),Qe=(e,t=1)=>_e(Re(e,t),t),xe=(e,t=1)=>_e(Ce(e,t),t),Ee=(e,t=1)=>Oe(Re(e,t),t),Ne=(e,t=1)=>Oe(Ce(e,t),t),Te=(e,t)=>{const i=[];for(const a of function*(e,t){for(;we(e);)yield e,e=t(e)}(t(e),t))i.push(a);return i},$e=e=>[_e(Re(e),2),_e(Ce(e),2),Re(_e(e),2),Re(Oe(e),2),Oe(Re(e),2),Oe(Ce(e),2),Ce(_e(e),2),Ce(Oe(e),2)].filter((e=>we(e))).map((e=>l(e))),je=e=>[Qe,xe,Ee,Ne].map((t=>Te(e,t))).map((e=>e.map((e=>l(e))))),ze=e=>[_e,Ce,Re,Oe].map((t=>Te(e,t))).map((e=>e.map((e=>l(e))))),Le=[],He=[],Ge=[],Fe=[],Ue=[],De=[],Je=[];for(const{rank:e,file:i}of function*(){for(let e=0;e<8;e++)for(let t=0;t<8;t++)yield{rank:e,file:t}}()){const a=l({rank:e,file:i});Le[a]=je({rank:e,file:i}),Ge[a]=[_e(Ve={rank:e,file:i}),Re(Ve),Ce(Ve),Oe(Ve),Qe(Ve),xe(Ve),Ee(Ve),Ne(Ve)].filter((e=>we(e))).map((e=>l(e))),He[a]=$e({rank:e,file:i}),Fe[a]=ze({rank:e,file:i}),Ue[a]=[...je({rank:e,file:i}),...ze({rank:e,file:i})],De[a]=[...Le[a].map((e=>({type:t.Bishop,ray:e}))),...Fe[a].map((e=>({type:t.Rook,ray:e})))],Je[a]=[...Le[a].flat(),...Fe[a].flat(),...He[a],...Ge[a]]}var Ve;const Xe=Le.map((e=>e.flat())),Ye=Fe.map((e=>e.flat())),Ze=Ue.map((e=>e.flat())),et=(Xe.map((e=>{const t=Array(64);return e.forEach((e=>t[e]=!0)),t})),Ye.map((e=>{const t=Array(64);return e.forEach((e=>t[e]=!0)),t})),Ze.map((e=>{const t=Array(64);return e.forEach((e=>t[e]=!0)),t}))),tt=(Je.map((e=>{const t=Array(64);return e.forEach((e=>t[e]=!0)),t})),Ze.map((e=>e.reduce(((e,t)=>e|Me[t]),BigInt(0)))),(e,t=1)=>e+8*t),it=(e,t=1)=>e-8*t,at=(e,t=1)=>e-1*t,nt=(e,t=1)=>e+1*t,ot=(e,t,i,{skip:a=[]})=>{const n=[],o=t.square;let s;for(const r of i){if(a.includes(r)){n.push({from:o,to:r,piece:t.piece});continue}const i=e.get(r);if(i){if(i.color===t.piece.color)break;s={attacked:{square:r,type:i.type},attacker:{square:o,type:t.piece.type},slideSquares:n.map((({to:e})=>e))},n.push({from:o,to:r,piece:t.piece,attack:s});break}n.push({from:o,to:r,piece:t.piece})}return n},st=(i,a,n,{attacksOnly:o,advanceOnly:s,enPassantSquare:r})=>{let c=[];const l=g(a),p=a===e.White?tt:it,u=a===e.White?it:tt;var k;if(!o&&(k=p(n))>=0&&k<64&&!i.get(p(n))&&(c.push({from:n,to:p(n),piece:{type:t.Pawn,color:a}}),!i.get(p(n,2))&&f(a,n)&&c.push({from:n,to:p(n,2),piece:{type:t.Pawn,color:a}})),!s){const e=p(at(n)),o=p(nt(n)),s=e===r?i.get(u(r)):i.get(e),g=o===r?i.get(u(r)):i.get(o);e%8!=7&&s?.color===l&&c.push({from:n,to:e,piece:{type:t.Pawn,color:a},attack:{attacker:{square:n,type:t.Pawn},attacked:{square:e,type:s.type},slideSquares:[]}}),o%8!=0&&g?.color===l&&c.push({from:n,to:o,piece:{type:t.Pawn,color:a},attack:{attacker:{square:n,type:t.Pawn},attacked:{square:o,type:g.type},slideSquares:[]}})}return((e,t)=>f(g(e),t))(a,n)&&(c=c.flatMap((e=>[t.Bishop,t.Knight,t.Queen,t.Rook].map((t=>({...e,promotion:t})))))),c},rt=(e,i,a)=>He[a].filter((t=>e.get(t)?.color!==i)).map((n=>{let o;const s=e.get(n);return s&&(o={attacker:{square:a,type:t.Knight},attacked:{square:n,type:s.type},slideSquares:[]}),{from:a,to:n,piece:{type:t.Knight,color:i},attack:o}})),ct=(e,i,a,{castlingOnly:n,castlingAvailability:o,pieceAttacks:s})=>{const r=n?[]:Ge[a].filter((t=>e.get(t)?.color!==i));return!o[i].kingside||e.get(nt(a))||0!==ut(e,g(i),nt(a),{enPassantSquare:null,skip:[a]}).length||e.get(nt(a,2))||r.push(nt(a,2)),!o[i].queenside||e.get(at(a))||0!==ut(e,g(i),at(a),{enPassantSquare:null,skip:[a]}).length||e.get(at(a,2))||e.get(at(a,3))||r.push(at(a,2)),r.map((n=>{let o;const s=e.get(n);return s&&(o={attacker:{square:a,type:t.King},attacked:{square:n,type:s.type},slideSquares:[]}),{from:a,to:n,piece:{type:t.King,color:i},attack:o}}))},lt=(e,i,a,{skip:n=[]})=>Le[a].flatMap((o=>ot(e,{square:a,piece:{color:i,type:t.Bishop}},o,{skip:n}))),pt=(e,i,a,{skip:n=[]})=>Fe[a].flatMap((o=>ot(e,{square:a,piece:{color:i,type:t.Rook}},o,{skip:n}))),ut=(i,a,n,{enPassantSquare:s,skip:r})=>{const c=[],l=g(a),p=[ct(i,l,n,{castlingOnly:!1,castlingAvailability:o,pieceAttacks:{[e.White]:new Map,[e.Black]:new Map}}),lt(i,l,n,{skip:r}),pt(i,l,n,{skip:r}),rt(i,l,n),st(i,l,n,{advanceOnly:!1,attacksOnly:!0,enPassantSquare:s})];for(const e of p)for(const a of e)if(a.attack){const e=i.get(a.to);a.attack.attacker.type===t.Bishop||a.attack.attacker.type===t.Rook?!e||e.type!==a.attack.attacker.type&&e.type!==t.Queen||c.push({attacked:a.attack.attacker,attacker:a.attack.attacked,slideSquares:a.attack.slideSquares}):e&&e.type===a.attack.attacker.type&&c.push({attacked:a.attack.attacker,attacker:a.attack.attacked,slideSquares:a.attack.slideSquares})}return c},gt=(e,t)=>{const i=new Map;for(let e=0;e<64;e++)i.set(e,[]);for(let a=0;a<64;a++){const n=ut(e,t,a,{enPassantSquare:null,skip:[]});for(const e of n){const t=i.get(e.attacker.square);if(!t)throw Error("cant be possible");t.push({square:a,attacker:e.attacker,slideSquares:e.slideSquares})}}return i},kt=(e,t)=>{const i=new Map;for(let a=0;a<64;a++){i.set(a,0);const n=ut(e,t,a,{enPassantSquare:null,skip:[]});i.set(a,n.length)}return i},ft=(t,i,a)=>{const n=i[e.White],o=i[e.Black];let s;return n&&(s=ut(t,e.Black,n,{...a,skip:[n]})),o&&(s=ut(t,e.White,o,{...a,skip:[o]})),{[e.White]:s||[],[e.Black]:[]}},ht=[[-5,-2,0,0,0,0,-2,-5],[1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1],[1,5,1,1,1,1,5,1],[1,1,6,1,1,6,1,1],[1,1,1,6,6,1,1,1],[2,8,-1,8,8,-1,8,2],[4,2,-2,-5,-5,-2,2,4]],dt=[[-10,-10,-10,-10,-10,-10,-10,-10],[-10,-10,-10,-10,-10,-10,-10,-10],[-10,-10,-10,-10,-10,-10,-10,-10],[0,-2,-5,-10,-10,-5,-2,0],[0,-2,-5,-10,-10,-5,-2,0],[0,0,-2,-10,-10,-2,0,0],[1,1,1,-10,-10,1,1,1],[5,5,10,-8,-8,5,10,5]],yt=[[-10,0,0,0,0,0,0,-10],[1,1,1,1,1,1,1,1],[-1,1,2,1,1,2,1,-1],[0,4,4,4,4,4,4,0],[0,1,2,4,4,2,1,0],[-1,1,10,1,1,10,1,-1],[-5,-1,1,6,6,1,-1,-5],[-10,-5,-1,0,0,-1,-5,-10]],Bt=[[0,0,0,0,0,0,0,0],[10,10,10,10,10,10,10,10],[6,1,5,7,7,5,1,6],[5,1,4,6,6,4,1,5],[4,1,1,5,5,1,1,4],[1,1,1,1,1,-3,1,1],[1,5,5,-10,-10,5,5,1],[0,0,0,0,0,0,0,0]],vt=[[-5,-2,0,0,0,0,-2,-5],[1,1,1,2,2,1,1,1],[1,1,2,6,6,2,1,1],[1,2,6,5,5,6,2,1],[1,2,6,8,8,6,2,1],[1,5,2,6,6,5,1,1],[2,1,5,2,5,-1,1,1],[-5,-2,-2,-1,-1,-2,-2,-5]],qt=[[5,5,5,5,5,5,5,5],[10,10,10,10,10,10,10,10],[0,0,0,0,0,0,0,0],[1,0,-2,-1,-1,-2,0,1],[1,0,-2,-1,-1,-2,0,1],[4,0,0,4,0,4,0,4],[0,0,0,1,1,0,0,0],[2,4,6,10,10,8,4,2]],bt={[t.Bishop]:{[e.White]:[...ht].reverse().flat(),[e.Black]:[...ht].flat()},[t.Knight]:{[e.White]:[...yt].reverse().flat(),[e.Black]:[...yt].flat()},[t.King]:{[e.White]:[...dt].reverse().flat(),[e.Black]:[...dt].flat()},[t.Pawn]:{[e.White]:[...Bt].reverse().flat(),[e.Black]:[...Bt].flat()},[t.Queen]:{[e.White]:[...vt].reverse().flat(),[e.Black]:[...vt].flat()},[t.Rook]:{[e.White]:[...qt].reverse().flat(),[e.Black]:[...qt].flat()}},mt=Object.freeze({[t.Bishop]:300,[t.King]:1/0,[t.Knight]:300,[t.Pawn]:100,[t.Queen]:900,[t.Rook]:500}),It=t=>t===e.White?1:-1,St=(e,t)=>bt[t.type][t.color][e],Pt=(e,i,a)=>{const n=new Map,o=De[i];for(const{type:i,ray:s}of o){const o=[],r=[];let c;for(const t of s){const i=e.get(t);if(i){if(i.color!==a){c={square:t,piece:i};break}o.push(t)}else r.push(t)}!c||c.piece.type!==i&&c.piece.type!==t.Queen||1===o.length&&n.set(o[0],{pinned:o[0],attacker:c.square,legalMoveSquares:[...r,...o]})}return n},At=(e,i,a,{enPassantSquare:n,castlingAvailability:o,pieceAttacks:s})=>{const r=[];switch(i.type){case t.Bishop:r.push(...lt(e,i.color,a,{skip:[]}));break;case t.King:r.push(...ct(e,i.color,a,{castlingOnly:!1,castlingAvailability:o,pieceAttacks:s}));break;case t.Knight:r.push(...rt(e,i.color,a));break;case t.Pawn:r.push(...st(e,i.color,a,{attacksOnly:!1,advanceOnly:!1,enPassantSquare:n}));break;case t.Queen:r.push(...((e,t,i,a)=>[...lt(e,t,i,a),...pt(e,t,i,a)])(e,i.color,a,{skip:[]}));break;case t.Rook:r.push(...pt(e,i.color,a,{skip:[]}))}return r},Wt=(e,i,{ignoreKing:a})=>{if(a&&i.piece.type===t.King)return!0;if(1===e.length){const t=e[0];return n=t.slideSquares,o=i.to,n.includes(o)||t.attacker.square===i.to}if(2===e.length)return!1;throw Error(`called with ${e.length} not exactly 1 or 2 checks`);var n,o},Kt=(e,t,i,a,n,o)=>{if(o){if(a.from===i)return 0===o.get(a.to);{const e=n.get(a.from);return!e||e.legalMoveSquares.includes(a.to)||a.to===e.attacker}}if(a.from===i)return 0===ut(e,g(t),a.to,{enPassantSquare:null,skip:[i]}).length;{const e=n.get(a.from);return!e||e.legalMoveSquares.includes(a.to)||a.to===e.attacker}},Mt=t=>(t=>{const i=h(t,e.White),a=h(t,e.Black),n={[e.White]:i,[e.Black]:a},o={[e.White]:gt(t.pieces,e.White),[e.Black]:gt(t.pieces,e.Black)},s={[e.White]:kt(t.pieces,e.White),[e.Black]:kt(t.pieces,e.Black)},r=((t,i)=>{const a=i[e.White],n=i[e.Black];let o,s;return a&&(o=Pt(t,a,e.White)),n&&(s=Pt(t,n,e.Black)),{[e.White]:o||new Map,[e.Black]:s||new Map}})(t.pieces,n),c=ft(t.pieces,n,{enPassantSquare:t.enPassantSquare,castlingAvailability:t.castlingAvailability});return{...t,kings:n,pieceAttacks:o,attackedSquares:s,checks:c,pinsToKing:r}})(d(t)),wt=(e,t)=>{const i=e.generateMoves();if(0===t)return 1;if(1===t)return i.length;let a=0;for(const n of i)e.applyMove(n),a+=wt(e,t-1),e.undoLastMove();return a},_t=(new Intl.NumberFormat,require("process")),[,,Ot,Rt,Ct]=_t.argv,Qt=B(Rt),xt=0===Ct.length?[]:Ct.split(" ").map((e=>(e=>{const t=e.slice(0,2),i=e.slice(2,4),a=e.slice(4,5),n={from:u(t),to:u(i)};return a.length>0&&(n.promotion=s[a]),n})(e))),Et=new class{constructor(e=B("8/8/8/8/8/8/8/8 w - - 0 1")){this._moveStack=[],this._position=Mt(e)}applyMove(i){const a=((i,a)=>{const{pieces:o}=i;let s=i.pieces.get(a.from);if(!s)throw Error("no piece to move");if(s.color!==i.turn)throw Error("cannot move piece for other color");const r={move:a,previousState:{castlingAvailability:{[e.White]:{kingside:i.castlingAvailability[e.White].kingside,queenside:i.castlingAvailability[e.White].queenside},[e.Black]:{kingside:i.castlingAvailability[e.Black].kingside,queenside:i.castlingAvailability[e.Black].queenside}},enPassantSquare:i.enPassantSquare,halfMoveCount:i.halfMoveCount,pinsToKing:{...i.pinsToKing},checks:{...i.checks}}};a.promotion&&(s={...s,type:a.promotion});let c=o.get(a.to);if(c&&(r.captured={square:a.to,piece:c}),o.delete(a.from),o.set(a.to,s),c&&c.type===t.Rook&&(a.to===n[c.color].queenside?i.castlingAvailability[c.color].queenside=!1:a.to===n[c.color].kingside&&(i.castlingAvailability[c.color].kingside=!1)),s.type===t.Pawn&&i.enPassantSquare===a.to){const t=s.color===e.White?it(a.to):tt(a.to);if(c=o.get(t),!c)throw Error("no piece captured with en passant capture");r.captured={square:t,piece:c},o.delete(t)}if(((i,a)=>!(i.type!==t.Pawn||!f(i.color,a.from))&&(i.color===e.White?a.to>=24&&a.to<32:a.to>=32&&a.to<40))(s,a)?i.enPassantSquare=s.color===e.White?tt(a.from):it(a.from):i.enPassantSquare=null,s.type===t.King)if(i.kings[s.color]=a.to,i.castlingAvailability[s.color].queenside=!1,i.castlingAvailability[s.color].kingside=!1,a.from-a.to==2){const a=n[s.color].queenside,o=s.color===e.White?3:59;i.pieces.delete(a),i.pieces.set(o,{color:s.color,type:t.Rook})}else if(a.from-a.to==-2){const a=n[s.color].kingside,o=s.color===e.White?5:61;i.pieces.delete(a),i.pieces.set(o,{color:s.color,type:t.Rook})}return s.type===t.Rook&&(a.from===n[s.color].queenside?i.castlingAvailability[s.color].queenside=!1:a.from===n[s.color].kingside&&(i.castlingAvailability[s.color].kingside=!1)),((e,i,a,n,o,s)=>{const r=a[n],c=a[g(n)];r&&(s.type===t.King||et[r][o.from]||et[r][o.to])&&(e[n]=Pt(i,r,n)),c&&(s.type===t.King||et[c][o.from]||et[c][o.to])&&(e[g(n)]=Pt(i,c,g(n)))})(i.pinsToKing,i.pieces,i.kings,i.turn,a,s),i.turn===e.Black&&i.fullMoveCount++,s.type===t.Pawn||c?i.halfMoveCount=0:i.halfMoveCount++,i.turn=g(i.turn),r})(this._position,i);return this._moveStack.push(a),a.captured?.piece}undoLastMove(){const i=this._moveStack.pop();if(!i)throw Error("no last move to undo");((i,a)=>{const{move:o}=a;let s=i.pieces.get(o.to);if(!s)throw Error("no piece to unmove");if(o.promotion&&(s={type:t.Pawn,color:s.color}),i.pieces.set(o.from,s),i.pieces.delete(o.to),a.captured&&i.pieces.set(a.captured.square,a.captured.piece),s.type===t.King)if(i.kings[s.color]=o.from,o.from-o.to==2){const a=n[s.color].queenside,o=s.color===e.White?3:59;i.pieces.delete(o),i.pieces.set(a,{color:s.color,type:t.Rook})}else if(o.from-o.to==-2){const a=n[s.color].kingside,o=s.color===e.White?5:61;i.pieces.delete(o),i.pieces.set(a,{color:s.color,type:t.Rook})}i.turn===e.White&&i.fullMoveCount--,i.turn=g(i.turn),i.castlingAvailability=a.previousState.castlingAvailability,i.enPassantSquare=a.previousState.enPassantSquare,i.halfMoveCount=a.previousState.halfMoveCount,i.pinsToKing=a.previousState.pinsToKing,i.checks=a.previousState.checks})(this._position,i)}evaluate(){return(e=>{let i=0;for(const[a,n]of e.pieces)n.type!==t.King&&(i+=(mt[n.type]+St(a,n))*It(n.color));return i+=20*It(e.turn),i/100})(this._position)}evaluateNormalized(){return this._position.turn===e.White?this.evaluate():-1*this.evaluate()}generateMoves(){return((e,t,{attackedSquares:i,pieceAttacks:a,pinsToKing:n,kings:s,enPassantSquare:r,castlingAvailability:c})=>{let l=[];const p=s[t];p&&(l=ut(e,g(t),p,{enPassantSquare:r,skip:[p]}));const u=((e,t)=>{const i=[],{color:a,enPassantSquare:n,castlingAvailability:o,pieceAttacks:s}=t;for(const[t,r]of e.entries())a&&r.color!==a||i.push(...At(e,r,t,{enPassantSquare:n,castlingAvailability:o,pieceAttacks:s}));return i})(e,{color:t,enPassantSquare:r,castlingAvailability:l.length>0?o:c,pieceAttacks:a});if(p)for(let i=u.length-1;i>=0;i--){const a=u[i];l.length>0&&!Wt(l,a,{ignoreKing:!0})?u.splice(i,1):Kt(e,t,p,a,n[t])||u.splice(i,1)}return u})(this._position.pieces,this._position.turn,{attackedSquares:this._position.attackedSquares,pieceAttacks:this._position.pieceAttacks,pinsToKing:this._position.pinsToKing,checks:this._position.checks,kings:this._position.kings,enPassantSquare:this._position.enPassantSquare,castlingAvailability:this._position.castlingAvailability})}get position(){return(e=>d((e=>{const{pieces:t,turn:i,castlingAvailability:a,enPassantSquare:n,halfMoveCount:o,fullMoveCount:s}=e;return{pieces:t,turn:i,castlingAvailability:a,enPassantSquare:n,halfMoveCount:o,fullMoveCount:s}})(e)))(this._position)}set position(e){this._position=Mt(e),this._moveStack=[]}get checks(){return ft(this._position.pieces,this._position.kings,{enPassantSquare:this._position.enPassantSquare,castlingAvailability:this._position.castlingAvailability})}get attacks(){return{[e.White]:kt(this._position.pieces,e.White),[e.Black]:kt(this._position.pieces,e.Black)}}get pins(){return[...Array.from(this._position.pinsToKing[e.White].values()),...Array.from(this._position.pinsToKing[e.Black].values())]}}(Qt);for(const e of xt)Et.applyMove(e);const Nt=((e,t)=>{if(0===t)return{counter:1,counts:{}};const i={},a=e.generateMoves();for(const n of a)e.applyMove(n),i[k(n,"")]=wt(e,t-1),e.undoLastMove();return{counter:Object.values(i).reduce(((e,t)=>e+t),0),counts:i}})(Et,Number(Ot));for(const[e,t]of Object.entries(Nt.counts))console.log(`${e} ${t}`);console.log(`\n${Nt.counter}`)})();